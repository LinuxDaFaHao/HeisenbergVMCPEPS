e0=[-20.04841380, -19.73848223, -20.05173561, -20.05324118, -20.05506943, -20.05632420, -20.05762672, -20.05826291, -20.06024073, -20.06247718, -20.06171400, -20.06264092, -20.06155367, -20.06345602, -20.06449331, -20.06502899, -20.06543217, -20.06581711, -20.06779602, -20.06775133, -20.07018507, -20.06977786, -20.07128447, -20.07102222, -20.07120753, -20.07138815, -20.07204226, -20.07202497, -20.07350209, -20.07463172, -20.07457783, -20.07549015, -20.07519127, -20.07640543, -20.07582957, -20.07847501, -20.07700366, -20.07857958, -20.07936174, -20.07933871, -20.07958735, -20.08101235, -20.08053773, -20.08098321, -20.08255465, -20.08108037, -20.08235147, -20.08316172, -20.08189679, -20.08261196, -20.08361310, -20.08339473, -20.08252767, -20.08362886, -20.08568924, -20.08752199, -20.08805233, -20.08938607, -20.08997395, -20.08944707, -20.09145624, -20.09452195, -20.09519296, -20.09299290, -20.09483401, -20.09359216, -20.09505225, -20.09524518, -20.09449612, -20.09429092, -20.09398281, -20.05554688, -20.01207629, -19.98192271, -20.09398281, -20.09344965, -20.09448536, -20.09430625, -20.09437365, -20.09331340, -20.09404248, -20.09178769, -20.09372233, -20.09622410, -20.09262091, -20.09444900, -20.09578888, -20.09670507, -20.09609202, -20.09419984, -20.09556449, -20.09804687, -20.09522146, -20.10018773, -20.10122756, -20.12151323, -20.12275664, -20.12371659, -20.12630540, -20.12446073, -20.12673824, -20.12706908, -20.12806046, -20.12830203, -20.12661244, -20.12671242, -20.12867165, -20.12990865, -20.12906587, -20.13076833, -20.13055369, -20.13158251, -20.13164256, -20.13126883, -20.13155930, -20.13278203, -20.13326649, -20.13316957, -20.13348368, -20.13339377, -20.13424105, -20.13467055, -20.13406996, -20.13480845, -20.13433837, -20.13433364, -20.13537398, -20.13650036, -20.13495840, -20.13652438, -20.13588818, -20.13628473, -20.13556775, -20.13762514, -20.13678691, -20.13729212, -20.13654603, -20.13733337, -20.13760888, -20.13869762, -20.13805473, -20.13826288, -20.13773543, -20.13785493, -20.13886048, -20.14024583, -20.13933858, -20.14006556, -20.14061185, -20.13981642, -20.14061025, -20.13986194, -20.14079832, -20.14115468, -20.14180959, -20.14088519, -20.14168281, -20.14175478, -20.14324269, -20.14294670, -20.14241369, -20.14228325, -20.14328004, -20.14373777, -20.14277374, -20.14282904, -20.14304666, -20.14447936, -20.14431072, -20.14396756, -20.14404266, -20.14305358, -20.14451318, -20.14445725, -20.14473872, -20.14538115, -20.14589108, -20.14498145, -20.14633199, -20.14676686, -20.14598586, -20.14604684, -20.14624841, -20.14654968, -20.14635230, -20.14676777, -20.14618771, -20.14751403, -20.14696506, -20.14657043, -20.14688012, -20.14655554, -20.14734098, -20.14637620, -20.14786717, -20.14800409, -20.14796383, -20.14827162, -20.14879604, -20.14830761, -20.14843589, -20.14830044, -20.14778950, -20.14772932, -20.14814249, -20.14945280, -20.14875702, -20.14906997, -20.14873476, -20.14863015, -20.14835588, -20.14818567, -20.14902398, -20.14914010, -20.14903513, -20.14997078, -20.14979499, -20.14986082, -20.14926035, -20.14944750, -20.14957524, -20.14970256, -20.15037180, -20.14977879, -20.15005907, -20.14913241, -20.14949712, -20.14953625, -20.15068279, -20.14929146, -20.14993042, -20.14982784, -20.15055276, -20.15095402, -20.15096859, -20.15058408, -20.15119737, -20.15046187, -20.15185650, -20.15015341, -20.15081411, -20.15102707, -20.15181050, -20.15169934, -20.15172639, -20.15131622, -20.15284558, -20.15223151, -20.15218084, -20.15235890, -20.15221265, -20.15300876, -20.15307028, -20.15281539, -20.15206895, -20.15412472, -20.15350264, -20.15368397, -20.15364472, -20.15403564, -20.15427046, -20.15383068, -20.15508186, -20.15393923, -20.15555924, -20.15502101, -20.15504574, -20.15500174, -20.15460937, -20.15556062, -20.15496846, -20.15561531, -20.15589877, -20.15515600, -20.15549809, -20.15663354, -20.15548690, -20.15728176, -20.15646538, -20.15603856, -20.15656193, -20.15686314, -20.15671340, -20.15664092, -20.15646612, -20.15695348, -20.15671201, -20.15742888, -20.15753054, -20.15792544, -20.15788028, -20.15691835, -20.15727248, -20.15732286];
e0=[e0, -20.15078372, -20.15089374, -20.15113786, -20.15074211, -20.15123652, -20.15117615, -20.15064476, -20.15188753, -20.15163829, -20.15162751, -20.15198122, -20.15226028, -20.15189228, -20.15235028, -20.15181591, -20.15304290, -20.15281862, -20.15323051, -20.15193255, -20.15289789, -20.15378228, -20.15319098, -20.15358050, -20.15299164, -20.15375481, -20.15381033, -20.15402694, -20.15352188, -20.15436754, -20.15453857, -20.15490584, -20.15474253, -20.15470493, -20.15461108, -20.15435436, -20.15483190, -20.15498049, -20.15587659, -20.15492717, -20.15572888, -20.15605341, -20.15615643, -20.15595702, -20.15672944, -20.15535461, -20.15634118, -20.15640127, -20.15590638, -20.15665669, -20.15797662, -20.15640308, -20.15711483, -20.15681650, -20.15693406, -20.15706121, -20.15758551, -20.15822620, -20.15784047, -20.15682987, -20.15779652, -20.15827098, -20.15814052, -20.15754719, -20.15868577, -20.15780423, -20.15827490, -20.15818852, -20.15908707, -20.15799012, -20.15885956, -20.15925493, -20.15841964, -20.15942072, -20.15865163, -20.15840516, -20.15887266, -20.15940339, -20.15996000, -20.15821253, -20.15922414, -20.15981157, -20.15947335, -20.15997406, -20.15945901, -20.16044378, -20.16008669, -20.15932641, -20.15916373, -20.15996052, -20.15972333, -20.16044072, -20.15932687, -20.15977312, -20.15996240, -20.16088355, -20.15994273, -20.16104413, -20.16133562, -20.15991094, -20.16170478, -20.16082631, -20.16172569, -20.16060639, -20.16099773, -20.16091779, -20.16058974, -20.16089793, -20.16101991, -20.16110749, -20.16157173, -20.16069499, -20.16178706, -20.16123701, -20.16129949, -20.16118695, -20.16110771, -20.16146132, -20.16279021, -20.16201145, -20.16123225, -20.16130626, -20.16165689, -20.16170061, -20.16164405, -20.16235942, -20.16202569, -20.16256784, -20.16141828, -20.16216589, -20.16211825, -20.16237924, -20.16144407, -20.16186950, -20.16203016, -20.16254045, -20.16215501, -20.16261555, -20.16232752, -20.16257734, -20.16244315, -20.16205225, -20.16271579, -20.16373355, -20.16253017, -20.16292139, -20.16318545, -20.16289129, -20.16246665, -20.16256745, -20.16331924, -20.16263353, -20.16345130, -20.16283265, -20.16265606, -20.16322694, -20.16353960, -20.16348753, -20.16359920, -20.16329870, -20.16294160, -20.16294819, -20.16382796, -20.16367007, -20.16385688, -20.16312059, -20.16385920, -20.16382949, -20.16349801, -20.16413374, -20.16375515, -20.16319178, -20.16383172, -20.16409104, -20.16425671, -20.16420096, -20.16417969, -20.16439218, -20.16423630, -20.16418979, -20.16410091, -20.16336739, -20.16403092, -20.16391246, -20.16401738, -20.16459575, -20.16440265, -20.16388476, -20.16451795, -20.16485797, -20.16390733, -20.16436030, -20.16450515, -20.16457476, -20.16455255, -20.16430733, -20.16437356, -20.16469184, -20.16470252, -20.16482936, -20.16498334, -20.16492888, -20.16448080, -20.16429931, -20.16398727, -20.16389843, -20.16471615, -20.16413532, -20.16450772, -20.16409609, -20.16445120, -20.16370497, -20.16432823, -20.16496458, -20.16468189, -20.16471448, -20.16470855, -20.16440104, -20.16383919, -20.16478431, -20.16417440, -20.16410324, -20.16366795, -20.16464663, -20.16435589, -20.16474283, -20.16426507, -20.16473457, -20.16497816, -20.16467781, -20.16424155, -20.16527260, -20.16416530, -20.16535288, -20.16477165, -20.16412191, -20.16434357, -20.16496486, -20.16412724, -20.16499068, -20.16580752, -20.16568054, -20.16525149, -20.16492552, -20.16454217, -20.16581068, -20.16542259, -20.16521450, -20.16459227, -20.16542889, -20.16508589, -20.16485971, -20.16500502, -20.16462153, -20.16458875, -20.16472887, -20.16497744, -20.16504154, -20.16467016, -20.16522259, -20.16591319, -20.16539240, -20.16559337, -20.16543991, -20.16559102, -20.16566087, -20.16598600, -20.16525772, -20.16596709, -20.16498718, -20.16499854, -20.16648320, -20.16539087, -20.16538473, -20.16614369, -20.16618625, -20.16537448, -20.16565526, -20.16596653, -20.16520185, -20.16533322, -20.16617492, -20.16563477, -20.16554423, -20.16579547, -20.16595079, -20.16563173, -20.16578934, -20.16574110, -20.16550157, -20.16607046, -20.16542703, -20.16545932, -20.16621285, -20.16485446, -20.16588877, -20.16556141, -20.16546359, -20.16570402, -20.16621991, -20.16589486];

e0_sg_a = [-19.75674157, -19.76474445, -19.77527321, -19.77031875, -19.74097702, -19.76281712, -19.78045006, -19.78292549, -19.78414134, -19.78116063, -19.79067025, -19.78520602, -19.79033609, -19.78887675, -19.79336955, -19.73583810, -19.76735835, -19.78849147, -19.79570467, -19.79705224, -19.79668185, -19.79756580, -19.78962201, -19.78262033, -19.68859798, -19.77108135, -19.79319029, -19.79760089, -19.80611679, -19.80761758, -19.80549305, -19.80918584, -19.80104937, -19.80089849, -19.80203171, -19.77690858, -19.80105876, -19.79552352, -19.74536437, -19.76494495, -19.80122497, -19.80334118, -19.79872777, -19.77116813, -19.80741342, -19.80331563, -19.78567910, -19.81248088, -19.80093077, -19.77189691, -19.64480872, -19.72721560, -19.43574375, -18.97641129, -19.73070969, -19.78796896, -19.80156896, -19.80507044, -19.81156324, -19.80581492, -19.81474715, -19.81924789, -19.81622657, -19.74218399, -19.79264840, -19.80843382, -19.81870055, -19.81122249, -19.79224266, -19.80199784, -19.74522732, -19.71680093, -19.78987447, -19.80468948, -19.81210418, -19.81104212, -19.82257852, -19.82454807, -19.80648246, -19.81555064, -19.81463738, -19.82584810, -19.82754322, -19.82913141, -19.82662148, -19.82554967, -19.82590158, -19.82707671, -19.82592929, -19.82364616, -19.82584689, -19.82667565, -19.82627238, -19.82665155, -19.82515814, -19.82937744, -19.83001461, -19.82904230, -19.82798364, -19.82700108];
e0_sg=[-20.15078372, -20.14946200, -20.15002654, -20.15064881, -20.15041332, -20.15066674, -20.15086389, -20.15044544, -20.15118350, -20.15013432, -20.15072597, -20.15070834, -20.15065439, -20.15076131, -20.15102571, -20.15019294, -20.15151154, -20.15176864, -20.15203888, -20.15087259, -20.15066900, -20.15147984, -20.15206842, -20.15176053, -20.15244999, -20.15205720, -20.15148774, -20.15085770, -20.15219562, -20.15233441, -20.15313294, -20.15340055, -20.15187340, -20.15204361, -20.15197712, -20.15187172, -20.15285129, -20.15261614, -20.15288611, -20.15271378, -20.15285752, -20.15296820, -20.15345006, -20.15325457, -20.15296435, -20.15219954, -20.15340865, -20.15314414, -20.15318631, -20.15328188, -20.15374158, -20.15165083, -20.15200293, -20.15240844, -20.15342673, -20.15400501, -20.15228561, -20.15416841, -20.15318994, -20.15347788, -20.15322280, -20.15429276, -20.15414420, -20.15466807, -20.15275183, -20.15048830, -20.15149240, -20.15244283, -20.15177055, -20.15312594, -20.15151788, -20.15223970, -20.15045550, -20.15091046, -20.15007374, -20.15148508, -20.15188823, -20.15212390, -20.15158409, -20.15063668, -20.15166346, -20.15182436, -20.15250305, -20.15278050, -20.15211725, -20.15371946, -20.15264277, -20.15353828, -20.15375858, -20.15304573, -20.15308639, -20.15273744, -20.15349979, -20.15397557, -20.15403668, -20.15406279, -20.15192373, -20.15310829, -20.15317820, -20.15287318];
sg_start = 294  ;
e0_ex = -20.1721138500429262; %dmrg 4000 state

e0D10 = [-20.12195786, -19.70143556, -20.12467624, -20.12853431, -20.12930135, -20.13049577, -20.13079783, -20.13248280, -20.13271553, -20.13360155, -20.13601292, -20.13629585, -20.13690028, -20.13710945, -20.13820864, -20.13855453, -20.13879190, -20.14119262, -20.12151994, -19.72053937, -20.12555042, -20.12698010, -20.12843667, -20.13105533, -20.13194375, -20.13215027, -20.13467240, -20.13631117, -20.13695339, -20.13753303, -20.13813660, -20.13951902, -20.14038653, -20.14102005, -20.14122589, -20.14310273, -20.14371486, -20.14398837, -20.14324625, -20.14439232, -20.14467350, -20.14524152, -20.14425940, -20.14582760, -20.14616569, -20.14677371, -20.14729290, -20.14680179, -20.14715100, -20.14774557, -20.14821643, -20.14890030, -20.14890371, -20.14932401, -20.14892260, -20.15017818, -20.14985940, -20.15021107, -20.15065668, -20.15112461, -20.15098809, -20.15103101, -20.15114490, -20.15201151, -20.15211058, -20.15265500, -20.15216610, -20.15232000, -20.15311682, -20.15306390, -20.15268744, -20.15380345, -20.15302077, -20.15428574, -20.15386528, -20.15431773, -20.15412933, -20.15464862, -20.15497460, -20.15523134, -20.15538881, -20.15511646, -20.15569572, -20.15546676, -20.15609860, -20.15631156, -20.15616605, -20.15651605, -20.15653872, -20.15632596, -20.15633146, -20.15753083, -20.15772193, -20.15714688, -20.15791229, -20.15691871, -20.15722673, -20.15755639, -20.15711533, -20.15754856, -20.15754748, -20.15749880, -20.15821905, -20.15799904, -20.15787831, -20.15811370, -20.15762580, -20.15816109, -20.15860311, -20.15806438, -20.15882175, -20.15961353, -20.15882255, -20.15791424, -20.15890329, -20.15807150, -20.15859935, -20.15818710, -20.15921861, -20.15846124, -20.15766070, -20.15868407, -20.15908521, -20.15889726, -20.15942055, -20.15927076, -20.15884748, -20.15882186, -20.15878704, -20.15840168, -20.15902562, -20.15848906, -20.15861238, -20.15904949, -20.15765136, -20.15924316, -20.15878670, -20.15843132, -20.15838333, -20.15855140, -20.15802225, -20.15966277, -20.15976440, -20.15934673, -20.15932230, -20.15923012, -20.15924544, -20.16043299, -20.15922733, -20.16022692, -20.15916907, -20.16062334, -20.16051928, -20.16023987, -20.16042648, -20.16099353, -20.16020134, -20.16113088, -20.16113263, -20.16069236, -20.16027516, -20.16156331, -20.16095449, -20.16126848, -20.16131947, -20.16081608, -20.16060864, -20.16143427, -20.16115343, -20.16119169, -20.16185414, -20.16190631, -20.16186345, -20.16154162, -20.16268566, -20.16230862, -20.16143663, -20.16129364, -20.16181957, -20.16140680, -20.16265262, -20.16266388, -20.16184433, -20.16147044, -20.16281993, -20.16357116, -20.16374799, -20.16251633, -20.16254158, -20.16348003, -20.16283626, -20.16364314, -20.16333082, -20.16380734, -20.16297126, -20.16313251, -20.16352155, -20.16386094, -20.16313316, -20.16332026, -20.16385232, -20.16408602, -20.16336313, -20.16375766, -20.16454900, -20.16311842, -20.16388151, -20.16385878, -20.16303776, -20.16443645, -20.16419852, -20.16467774, -20.16357491, -20.16243266, -20.16547718, -20.16322169, -20.16687114, -20.16248539, -20.16430816, -20.16484090, -20.16442412, -20.16465183, -20.16471533, -20.16450103, -20.16483998, -20.16458692, -20.16305325, -20.16428487];
e0D10_a = e0D10(1:18);
e0D10_b = e0D10(19:end);

e0D12 = [-20.13519276, -19.66343616, -20.13393506, -20.13684585, -20.13978129, -20.14109471, -20.14267587, -20.14337133, -20.14330264, -20.14507989, -20.14487593, -20.14867955, -20.14830805, -20.14989565, -20.15011575, -20.15061562, -20.15267687, -20.15221042, -20.15233724, -20.15362626, -20.15226478, -20.15332695, -20.15389633, -20.15372600, -20.15472443, -20.15457811, -20.15505948, -20.15464171, -20.15561091, -20.15600110, -20.15630233, -20.15575451, -20.15563040, -20.15579359, -20.15633283, -20.15654329, -20.15666709, -20.15606358, -20.15692740, -20.15682105, -20.15668425, -20.15729942, -20.15726960, -20.15697982, -20.15751591, -20.15727453, -20.15722559, -20.15726337, -20.15704618, -20.15752483];
e0D12 = [e0D12, -20.15903804, -20.15940047, -20.15915598, -20.15902672, -20.15927744, -20.15902990, -20.15900132, -20.15884183, -20.15979785, -20.16051830, -20.15998450, -20.16114878, -20.15998808, -20.16134263, -20.16134302, -20.16031431, -20.16098835, -20.16048271, -20.16124416, -20.16061160, -20.16181752, -20.16128341, -20.16146043, -20.16233874, -20.16171292, -20.16197034, -20.16179914, -20.16172363, -20.16212013, -20.16198254, -20.16199223, -20.16176346, -20.16279894, -20.16159494, -20.16166713, -20.16203838, -20.16180397, -20.16116112, -20.16012400, -20.16010095, -20.15957680, -20.16260676, -20.16350733, -20.16396888, -20.16473687, -20.16517537, -20.16518199, -20.16609814, -20.16523318, -20.16477197, -20.16543070, -20.16560136, -20.16479466, -20.16554222, -20.16533361, -20.16577956, -20.16644076, -20.16590403, -20.16592014, -20.16537837, -20.16542318, -20.16668474, -20.16658513, -20.16611395, -20.16684603, -20.16617653, -20.16667296, -20.16686641, -20.16710380, -20.16627640, -20.16670040, -20.16709846, -20.16689146, -20.16709981, -20.16698102, -20.16746266, -20.16667894, -20.16678596, -20.16739984, -20.16761328, -20.16759731, -20.16652187, -20.16779322, -20.16759539, -20.16796687, -20.16752495, -20.16818677, -20.16737657, -20.16754704, -20.16753846, -20.16748827, -20.16763696, -20.16780439, -20.16791792, -20.16867114, -20.16815200, -20.16824714, -20.16831991, -20.16831568, -20.16819766, -20.16830224, -20.16826072, -20.16825932, -20.16844649, -20.16852740, -20.16887015, -20.16840635, -20.16831315, -20.16808639, -20.16882642, -20.16883935, -20.16896989, -20.16901494, -20.16914006, -20.16922132, -20.16893431, -20.16907426, -20.16911573, -20.16896946, -20.16915141, -20.16904401, -20.16922354, -20.16904959, -20.16912879, -20.16915426, -20.16918027, -20.16905117, -20.16924879, -20.16957788, -20.16938736, -20.16952250, -20.16922972, -20.16950983, -20.16974001, -20.16923536, -20.16956634, -20.16911998, -20.16910683, -20.16976154, -20.16975839, -20.16905182, -20.17022547, -20.16994668, -20.16968832, -20.16947710, -20.16999786, -20.16957014, -20.16965577, -20.16994321, -20.17014582, -20.17022732, -20.16983091, -20.16990233, -20.16976985, -20.17005817, -20.17000402, -20.16991240, -20.16975775, -20.17025996, -20.17015362, -20.17035381, -20.17042295, -20.17012699, -20.16997401, -20.17003780, -20.16986600, -20.16944603, -20.16999985, -20.17020748, -20.17044815, -20.16979275, -20.17033649, -20.17018412, -20.16992422, -20.16987605, -20.17010852, -20.17011990, -20.16993187, -20.16985071, -20.16991196];
h0=semilogy((e0 -e0_ex)/abs(e0_ex), 'o','LineWidth', 2); hold on;
h1=semilogy((e0_sg_a -e0_ex)/abs(e0_ex), 'o','LineWidth', 2); hold on;
h2=semilogy( sg_start:sg_start+numel(e0_sg)-1, (e0_sg -e0_ex)/abs(e0_ex), 'o','LineWidth', 2); hold on;
h3=semilogy((e0D10_a -e0_ex)/abs(e0_ex), 'o','LineWidth', 2); hold on;
h4=semilogy((e0D10_b -e0_ex)/abs(e0_ex), 'o','LineWidth', 2); hold on;
h5=semilogy((e0D12 -e0_ex)/abs(e0_ex), 'o','LineWidth', 2); hold on;
T=text(200,0.03,['$4\times 4$, PEPS $D=8$', char(10),...
                'Boundary MPS $\chi=24$', char(10),...
                'Typical step length $\alpha = 0.2$', char(10),...
                'Typical Samples = 56 chains $\times 2000$.']);
set(T,'Interpreter','latex');
set(T,'Fontsize',18);


l=legend([h0, h1, h2,h3, h4,h5], {'SR, $D=8$', 'Gradient, $D=8$', ...
    'Gradient, $D=8, \alpha = 0.01$', 'SR, $D=10, \alpha = 0.2$', ...
    'SR, $D=10$', ... %$\alpha=0.3$ for initial and final stage, varies in middle stage
    'SR, $D=12$'});
set(l,'Box','off');set(l,'Interpreter','latex');
set(l,'Fontsize',18);
set(l,'Location','NorthEast');

xlabel('Iteration','Interpreter','latex')
% ylabel('Persite energy $e_0$','Interpreter','latex')
ylabel('energy relative error','Interpreter','latex')
set(gca,'fontsize',24);
set(gca,'linewidth',1.5);
set(get(gca,'Children'),'linewidth',2); % Set line width 1.5 pounds
set(get(gca,'XLabel'),'FontSize',24);
set(get(gca,'YLabel'),'FontSize',24);
set(gcf, 'position',  [100, 100, 1300, 600]);
hold off;

figure_directory = './';
figure_name_eps = 'EnergyDecreasingKagome4x4.eps';
figure_path = fullfile(figure_directory, figure_name_eps);
saveas(gcf, figure_path, 'epsc');
disp(['Energy deceasing of the heisenberg model: ', figure_path]);